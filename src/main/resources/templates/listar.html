<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/layout :: head"></head>
<script th:src="@{/js/queryloader2/queryloader2.min.js}"></script>
<body>

	<header th:replace="layout/layout :: header"></header>

	<script type="text/javascript">
	    window.addEventListener('DOMContentLoaded', function() {
	        new QueryLoader2(document.querySelector("body"), {
	            barColor: "#007bff",
	            backgroundColor: "#343a40",
	            percentage: true,
	            barHeight: 2,
	            minimumTime: 250,
	            fadeOutTime: 800
	        });
	    });
	</script>

	<div class="container-fluid py-3 col-md-11 col-sm-12">

		<div class="card shadow card-table">
	                <div class="card-header bg-dark text-white">
	                 	<h5>Listado de Empleados  <small class="float-right" th:text="'Total de empleados: '+${totalEmpleados}"></small> </h5>
	                 	
	                </div>
	                
	                <div class="row">			
					<div class="col-sm text-center mt-2 ">
						<a href="#" data-toggle="modal" data-target="#modalCrearEmpleado" 
						class="btn btn-primary mt-3 font-weight-bold text-white">Crear un nuevo
							Empleado</a>
					</div>
					
					<div class="modal fade" id="modalCrearEmpleado" tabindex="-1"
								role="dialog" aria-labelledby="modalCrearEmpleado" aria-hidden="true">
								<div class="modal-dialog modal-dialog-centered modal-lg"
									role="document">
									<div class="modal-content">
										<div class="modal-header bg-dark text-white">
											<h5 class="modal-title w-100"
												id="exampleModalLongTitle">Formulario para la creación del empleado</h5>
											<button type="button" class="close text-white"
												data-dismiss="modal" aria-label="Close">
												<span aria-hidden="true">&times;</span>
											</button>
										</div>
										<div class="modal-body">
	
											<form th:action="@{/form}" th:object="${empleado}" method="post">
						
											<div class="row">
						
												<div class="col-sm-12 col-md-12 col-lg-12">
													<div class="row pb-2">
														<h5 class="col-md-12 text-center mark">Datos personales</h5>
													</div>
													
													<div class="row">
														<div class="col-xs-12 col-md-6 col-lg-6">
															<div class="form-group input-group">
																
																<div class="input-group-prepend">
																    <span class="input-group-text"> <i class="fa fa-user"></i> </span>
																 </div>									
																<input type="text" class="form-control" th:field="*{nombre}"
																placeholder="Nombre" required="required"/> 
															</div>
														</div>
														<div class="col-xs-12 col-md-6 col-lg-6">
															<div class="form-group input-group">
																
																<div class="input-group-prepend">
																    <span class="input-group-text"> <i class="fa fa-user"></i> </span>
																 </div>									
																<input type="text" class="form-control" th:field="*{apellido1}"
																placeholder="Primer Apellido"
																required="required"/> 
															</div>
														</div>
													</div>
													
													<div class="row">
														<div class="col-xs-12 col-md-6 col-lg-6">
															<div class="form-group input-group">
																
																<div class="input-group-prepend">
																    <span class="input-group-text"> <i class="fa fa-user"></i> </span>
																 </div>									
																<input type="text" class="form-control" th:field="*{apellido2}"
																placeholder="Segundo Apellido"
																required="required"/> 
															</div>
														</div>
														<div class="col-xs-12 col-md-6 col-lg-6">
															<div class="form-group input-group">
																
																<div class="input-group-prepend">
																    <span class="input-group-text"> <i class="fas fa-calendar-alt"></i> </span>
																 </div>									
																<input type="text" class="form-control" th:field="*{fechaNacim}"
																	 onfocus="(this.type='date')"
																	placeholder="Fecha de Nacimiento"
																	required="required" /> 
															</div>
														
														</div>
												</div>
												
												<div class="row pb-2">
													<h5 class="col-md-12 text-center mark">Datos de dirección</h5>
												</div>
														
													<div class="row">
														<div class="col-xs-12 col-md-6 col-lg-6">
															<div class="form-group input-group">
																
																<div class="input-group-prepend">
																    <span class="input-group-text"> <i class="fas fa-compass"></i> </span>
																 </div>									
																<input type="text" class="form-control" th:field="*{direccion}"
																placeholder="Dirección completa"
																th:errorclass="'form-control alert-danger'" /> 
															</div>
															<small
																class="form-text text-danger"
																th:if="${#fields.hasErrors('direccion')}" th:errors="*{direccion}"></small>
														</div>
														<div class="col-xs-12 col-md-6 col-lg-6">
															<div class="form-group input-group">
																
																<div class="input-group-prepend">
																    <span class="input-group-text"><i class="fas fa-map-marker-alt"></i> </span>
																 </div>									
																<input type="text" class="form-control" th:field="*{localidad}"
																placeholder="Localidad"
																th:errorclass="'form-control alert-danger'" /> 
															</div>
															<small
																class="form-text text-danger"
																th:if="${#fields.hasErrors('localidad')}" th:errors="*{localidad}"></small>
														</div>
													</div>
													
														<div class="row">
														<div class="col-xs-12 col-md-6 col-lg-6">
															<div class="form-group input-group">
																
																<div class="input-group-prepend">
																    <span class="input-group-text"> <i class="fas fa-map-marker-alt"></i> </span>
																 </div>									
																<input type="text" class="form-control" th:field="*{provincia}"
																placeholder="Provincia"
																th:errorclass="'form-control alert-danger'" /> 
															</div>
															<small
																class="form-text text-danger"
																th:if="${#fields.hasErrors('provincia')}" th:errors="*{provincia}"></small>
														</div>
														<div class="col-xs-12 col-md-6 col-lg-6">
															<div class="form-group input-group">
																
																<div class="input-group-prepend">
																    <span class="input-group-text"> <i class="fas fa-flag"></i> </span>
																 </div>									
																<input type="text" class="form-control" th:field="*{pais}"
																placeholder="País"
																th:errorclass="'form-control alert-danger'" /> 
															</div>
															<small
																class="form-text text-danger"
																th:if="${#fields.hasErrors('pais')}" th:errors="*{pais}"></small>
														</div>
													</div>
												
													<div class="row text-center">
														<div class="col-md-12 mt-2 mb-2">
						
															<div class="col-md-12">
																<h6>Permiso para el usuario (Usuario / Administrador)</h6>
																
																<input th:field="*{esAdmin}" 
																	type="checkbox" checked data-toggle="toggle" 
																	data-onstyle="success" data-offstyle="danger">
															        
															</div>
															<hr />
															</div> 
													</div>
													
												</div>
													
											</div>
						
											<div class="row">
												<div class="col-md-12 text-center">
													
													
														<div class="form-group">
															<input value="Crear Empleado" type="submit"
																class="btn btn-lg btn-primary" />
														</div>
												
						
												</div>
						
						
											</div>
						
										</form>														
												
										</div>						
									</div>
								</div>
							</div>
							
				</div>
			<div class="card-body table-responsive ">
			
				<table id="tablaListar" class="table-hover table-borderless dataTables_length text-center">
					<thead class="thead-dark bg-dark text-white">
						<tr>
							<th>Usuario</th>
							<th>Nombre</th>
							<th>Primer Apellido</th>
							<th>Segundo Apellido</th>
							<th>Fecha Nacimiento</th>
							<th>Editar</th>
							<th>Eliminar</th>
						</tr>
					</thead>
					<tbody id="myTable">
						<tr th:each="empleado : ${empleados}">
							<td class="align-middle" th:text="${empleado.usuario.username}"></td>
							<td class="align-middle" th:text="${empleado.nombre}"></td>
							<td class="align-middle" th:text="${empleado.apellido1}"></td>
							<td class="align-middle" th:text="${empleado.apellido2}"></td>
							<td class="align-middle" th:text="${empleado.fechaNacim}"></td>
							<td class="align-middle"><a class="btn-lg"
								th:href="@{/editar/} + ${empleado.cod_empl}">
								<i class="far fa-edit"></i>
								</a></td>
							<td class="align-middle">
								<a onclick="return mostrarConfirmacion()"
								 href="#" class="btn-lg">
								<i class="fas fa-trash-alt" style="color: red;"></i>
								</a>
							</td>

						</tr>
					</tbody>

				</table>
				</div>

				
			</div>
		</div>

		<!-- Modal -->
		<div class="modal fade" id="modalFlash" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
		  <div class="modal-dialog modal-dialog-centered" role="document">
		    <div class="modal-content">
		      <div th:class="${tipo == 'Error'} ? 'modal-header bg-danger text-white' : 'modal-header bg-primary text-white'">
		        <div class="modal-title" id="exampleModalLongTitle">
		        	<i class="fas fa-exclamation-triangle"></i>
		        	<span th:text="${tipo}"></span>
		        </div>
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          <span aria-hidden="true">&times;</span>
		        </button>
		      </div>
		      <div class="modal-body">
		      	<h6 th:text="${message}"></h6>
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
		      </div>
		    </div>
		  </div>
		</div>

	<footer th:replace="layout/layout :: footer"></footer>
	<input type="hidden" id="urlAjaxEliminarEmpleado" th:value="@{'/listar/eliminar'}" />
	<script th:inline="javascript">

	$(document).ready( function () {
		var message = /*[[${message}]]*/;
		if(message.length > 0){
			$('#modalFlash').modal('show');
		}
		
	});
	
	</script>
	
	<script>

	
	$(document).ready( function () {
		 var table = $('#tablaListar').DataTable({
				 "pagingType": "numbers",
		        "language": {
		            "lengthMenu": "Mostrar _MENU_ por página",
		            "zeroRecords": "Sin resultados",
		            "info": "Mostrando página _PAGE_ de _PAGES_",
		            "infoEmpty": "No hay datos disponibles",
		            "infoFiltered": "(filtrados de _MAX_ registros en total)",
		            "loadingRecords": "Cargando...",
		            "processing":     "Procesando...",
		            "search": "Buscar:"
		           
		        },
		        responsive: true,
		        "lengthMenu": [ 10, 15, 20 , 25 ]
		    });
	});
	</script>
	
	<script>

	function mostrarConfirmacion(){
		
		var urlAjax = $("#urlAjaxEliminarEmpleado").val();
		var table = $('#tablaListar').DataTable();
		$('#tablaListar tbody').one('click', 'tr', function () {
	        var data = table.row( this ).data();
	        var usuario=data[0];
		
			Swal.fire({
				  title: '¿Estás seguro de borrar al usuario '+usuario+'?',
				  text: "Este proceso no se puede revertir",
				  icon: 'warning',
				  showCancelButton: true,
				  confirmButtonColor: '#3085d6',
				  cancelButtonColor: '#d33',
				  confirmButtonText: 'Si'
				}).then((result) => {
				  if (result.value) {
				    Swal.fire({
				      icon: 'success',
				      title: 'El usuario ha sido eliminado.',
				      showConfirmButton: false,
				      timer: 1500,
				      onClose: () => {
				    	  location.reload();
				   	  }
				    })  
				
				    $.ajax({
						type: "GET",
						url: urlAjax,
						data: {
							"username" : usuario
						}
					});
				    
				  }
			})
		});
	};

	</script>

</body>
</html>